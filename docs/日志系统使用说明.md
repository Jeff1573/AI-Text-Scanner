# 日志系统使用说明

## 概述

项目已集成 Winston 日志库，提供了统一的日志管理功能。日志系统支持多级别日志、文件输出、控制台输出等功能。

## 特性

- **多级别日志**：error、warn、info、debug、verbose
- **文件输出**：自动保存到用户数据目录的 logs 文件夹
- **控制台输出**：开发环境下彩色输出
- **文件轮转**：自动限制日志文件大小和数量
- **模块化**：每个模块可以创建独立的日志器

## 使用方法

### 1. 创建模块日志器

```typescript
import { createModuleLogger } from "../utils/logger";

// 创建模块日志器
const logger = createModuleLogger('YourModuleName');
```

### 2. 使用日志方法

```typescript
// 错误日志
logger.error('发生错误', { error: error.message, stack: error.stack });

// 警告日志
logger.warn('警告信息', { additionalData: 'some data' });

// 信息日志
logger.info('重要信息');

// 调试日志
logger.debug('调试信息', { debugData: 'some debug info' });

// 详细日志
logger.verbose('详细调试信息');
```

### 3. 日志格式

日志输出格式：
```
2024-01-01 12:00:00 INFO [Main] 应用启动，开始初始化...
2024-01-01 12:00:01 DEBUG [WindowManager] 图标路径 {"iconPath":"/path/to/icon.ico"}
2024-01-01 12:00:02 ERROR [ConfigManager] 配置加载失败 {"error":"文件不存在"}
```

## 日志文件

- **error.log**：只包含错误级别的日志
- **combined.log**：包含所有级别的日志

日志文件位置：`%APPDATA%/ai-text-scanner/logs/` (Windows)

## 配置

### 日志级别

- **开发环境**：debug 级别（显示所有日志）
- **生产环境**：info 级别（只显示重要日志）

### 文件轮转

- 单个文件最大：5MB
- 错误日志保留：5个文件
- 完整日志保留：10个文件

## 最佳实践

1. **使用合适的日志级别**
   - error：系统错误、异常
   - warn：警告信息、潜在问题
   - info：重要操作、状态变更
   - debug：调试信息、详细数据
   - verbose：非常详细的调试信息

2. **结构化日志数据**
   ```typescript
   // 好的做法
   logger.error('API调用失败', { 
     url: 'https://api.example.com', 
     statusCode: 500, 
     error: error.message 
   });

   // 避免的做法
   logger.error('API调用失败: ' + error.message);
   ```

3. **模块化日志器**
   - 每个模块使用独立的日志器
   - 便于过滤和查找特定模块的日志

4. **敏感信息处理**
   - 不要在日志中记录密码、API密钥等敏感信息
   - 使用占位符或脱敏处理

## 示例

### 主进程日志
```typescript
import { createModuleLogger } from "./utils/logger";

const logger = createModuleLogger('Main');

app.on("ready", () => {
  try {
    logger.info('应用启动，开始初始化...');
    // 初始化代码...
    logger.info('应用初始化完成');
  } catch (error) {
    logger.error('应用初始化失败', { 
      error: error.message, 
      stack: error.stack 
    });
  }
});
```

### 管理器日志
```typescript
import { createModuleLogger } from "../utils/logger";

const logger = createModuleLogger('WindowManager');

createMainWindow(): BrowserWindow | null {
  try {
    logger.info("开始创建主窗口...");
    // 创建窗口代码...
    logger.info("主窗口创建完成");
  } catch (error) {
    logger.error("创建主窗口失败", { 
      error: error.message, 
      stack: error.stack 
    });
  }
}
```

## 迁移指南

从 console.log 迁移到 Winston：

```typescript
// 旧代码
console.log('[Module] 信息');
console.error('[Module] 错误:', error);

// 新代码
const logger = createModuleLogger('Module');
logger.info('信息');
logger.error('错误', { error: error.message });
```

## 故障排除

1. **日志文件不生成**
   - 检查用户数据目录权限
   - 确认应用有写入权限

2. **日志级别不正确**
   - 检查 NODE_ENV 环境变量
   - 确认应用是否为打包版本

3. **日志文件过大**
   - 检查文件轮转配置
   - 考虑调整日志级别
